---
title: "ディスク関連コマンドメモ"
date: 2022-12-25T01:25:03+09:00
lastmod: 2022-12-27
draft: false
categories: [メモ]
toc: true
---
Ubuntuで使えるディスク関連コマンドメモ
### 全ブロックデバイスを表示する
```bash
sudo fdisk -l
```
### ディスクの空き容量やマウント状況を表示する
マウントされていないディスクは表示されない
```bash
df -h
```
### ディスクへのパーティション作成、ラベル作成など
```bash
sudo parted ${ブロックデバイスへのパス}
```
#### gptラベル作成
```bash
mklabel gpt
```

#### パーティション作成
```bash
mkpart
```
パーティションのStartとEndの指定は%指定でやると便利

### ext4の初期化
`fdisk`で新しくパーティションを区切ることによってできたディスクのパスを確認した後に作成

```bash
sudo mkfs.ext4 /dev/${パス}
```
### /etc/fstabへの記述
/etc/fstabに記述して再起動してもディスクがマウントされるようにする
#### パーティションUUIDの調査
```bash
sudo blkid
```
`UUID`を探す

`UUID`と`PARTUUID`は別物です

#### マウント先を用意する
適当にmkdirしてフルパスを控えておく

#### fstabの記述
`device`, `dir`, `type`, `options`, `dump`, `fsck` の順で記述していく

deviceにはUUID=などでデバイスの固有番号を記述する

dirにはマウント先のフルパスを記述する

typeにはファイルシステム名を記述する(`ext4`など)

optionsにはオプションを記述する(コンマ区切り)

**ここには私が選んだ主要オプションのみ記述します。もっと詳しく知りたい方は`man mount.8`の中の`FILESYSTEM-INDEPENDENT MOUNT OPTIONS`節などを見てください**
- defaults

  `rw, suid, dev, exec, auto, nouser, async` を一つの記述で指定する。普通のディスクだったらこれさえ指定しておけば良い

- nofail

  指定されたディスクが見つからなくてもエラーを出さずに起動する(nofailが付いていないディスクが見つからない場合は見つかるまで永遠探し続けるため、ディスクが接続されるまで起動しない)

- _netdev

  smbなどでマウントするディスクに付ける。ネットワーク関連プロセスが起動するまでマウントの実行を遅らせる

dumpには基本的に0を指定


fsckには起動時にチェックするファイルシステムの順番を設定する。ルートファイルシステムには1をそれ以外には0(無効)もしくは2を設定すべき(数字はかぶっていてもよい)

### fstabに書いてある記述にしたがってすべてのディスクをマウントする
```bash
sudo mount -a
```
fstabの記述が間違っているとエラります